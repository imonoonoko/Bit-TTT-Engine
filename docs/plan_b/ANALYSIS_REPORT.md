# ANALYSIS_REPORT.md - Bit-TTT ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åˆ†æ

**ä½œæˆæ—¥**: 2026-01-11
**ç›®çš„**: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã®ã‚¹ã‚³ãƒ¼ãƒ—ç‰¹å®šãŠã‚ˆã³æŠ€è¡“çš„è² å‚µã®å¯è¦–åŒ–

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ æ¦‚è¦

```
crates/
â”œâ”€â”€ bit_llama/        # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (CLI, GUI, Training Pipeline)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ cli.rs          (867B)  - CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ config.rs       (3KB)   - è¨­å®šç®¡ç†
â”‚       â”œâ”€â”€ data.rs         (5KB)   - ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
â”‚       â”œâ”€â”€ evaluate.rs     (5KB)   - è©•ä¾¡ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
â”‚       â”œâ”€â”€ export.rs       (2KB)   - ãƒ¢ãƒ‡ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚       â”œâ”€â”€ gui/            (3ãƒ•ã‚¡ã‚¤ãƒ«) - GUI (eframe)
â”‚       â”œâ”€â”€ inference.rs    (1.5KB) - æ¨è«–ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚       â”œâ”€â”€ loader.rs       (3KB)   - å…±é€šDataLoader
â”‚       â”œâ”€â”€ state.rs        (8KB)   - GUIãƒ©ãƒ³ã‚¿ã‚¤ãƒ çŠ¶æ…‹
â”‚       â”œâ”€â”€ train.rs        (20KB, 565L) âš ï¸ - å­¦ç¿’ãƒ«ãƒ¼ãƒ—ï¼ˆè¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰
â”‚       â””â”€â”€ vocab.rs        (3KB)   - ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¶ãƒ¼å­¦ç¿’
â””â”€â”€ rust_engine/      # ã‚³ã‚¢ã‚¨ãƒ³ã‚¸ãƒ³å±¤ (ãƒ¢ãƒ‡ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
    â””â”€â”€ src/
        â”œâ”€â”€ core_engine.rs  (39KB, 1097L) âš ï¸ - BitLlamaå®Ÿè£…ï¼ˆè¦åˆ†å‰²ï¼‰
        â”œâ”€â”€ legacy/         (deprecated ndarrayå®Ÿè£…)
        â”‚   â”œâ”€â”€ bit_linear.rs
        â”‚   â”œâ”€â”€ ttt_layer.rs
        â”‚   â””â”€â”€ c_api.rs
        â””â”€â”€ lib.rs          - å…¬é–‹API
```

---

## 2. æŠ€è¡“çš„è² å‚µã®ç‰¹å®š

### ğŸ”´ é«˜å„ªå…ˆåº¦

| ãƒ•ã‚¡ã‚¤ãƒ« | å•é¡Œç‚¹ | æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|----------|--------|----------------|
| `core_engine.rs` | **1097è¡Œã®å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«**ã€‚RMSNorm, BitLinear, SwiGLU, TTTLayer, BitLlamaBlock, Llama, PyBitLlama ãŒå…¨ã¦åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²: `layers/`, `model.rs`, `python.rs` |
| `train.rs` | **565è¡Œã®ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯é–¢æ•° `run()`** (L101-L564)ã€‚è¨­å®šã€ãƒ«ãƒ¼ãƒ—ã€ä¿å­˜ã€ãƒ­ã‚°ãŒæ··åœ¨ | è²¬å‹™åˆ†é›¢: `TrainingLoop`, `CheckpointManager`, `MetricsLogger` |
| `legacy/` | **Deprecated** ã ãŒæ®‹å­˜ã€‚ndarrayä¾å­˜ã€‚ | Phaseå®Œäº†å¾Œã«å®‰å…¨ã«å‰Šé™¤å¯èƒ½ã‹ç¢ºèª |

### ğŸŸ¡ ä¸­å„ªå…ˆåº¦

| ãƒ•ã‚¡ã‚¤ãƒ« | å•é¡Œç‚¹ | æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|----------|--------|----------------|
| `state.rs` | `ProjectState` ãŒè‚¥å¤§åŒ– (7901B)ã€‚ãƒ­ã‚°ã€ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãŒæ··åœ¨ | `LogManager`, `ProcessManager` ã¸ã®åˆ†é›¢æ¤œè¨ |
| `gui/mod.rs` | `BitStudioApp` ãŒçŠ¶æ…‹+æç”»+ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿æŒ | MVVMãƒ‘ã‚¿ãƒ¼ãƒ³å°å…¥æ¤œè¨ |
| `loader.rs` | `BitLoader` ãŒãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ—ã¨ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’æ‹…å½“ | å˜ä¸€è²¬ä»»åŸå‰‡ã«æ²¿ã£ã¦åˆ†é›¢ |

### ğŸŸ¢ ä½å„ªå…ˆåº¦

| ãƒ•ã‚¡ã‚¤ãƒ« | å•é¡Œç‚¹ | æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
|----------|--------|----------------|
| `cli.rs` | ç¾çŠ¶ã§è‰¯å¥½ | - |
| `config.rs` | ç¾çŠ¶ã§è‰¯å¥½ | - |
| `export.rs` | ç¾çŠ¶ã§è‰¯å¥½ | - |

---

## 3. è¨­è¨ˆæ„å›³ã®è¨€èªåŒ–

### `core_engine.rs` ã®è¨­è¨ˆ

- **BitLinear**: 1.58-bité‡å­åŒ–ç·šå½¢å±¤ã€‚å­¦ç¿’æ™‚ã¯fp32ã€æ¨è«–æ™‚ã¯é‡å­åŒ–æ¸ˆã¿é‡ã¿ã‚’ä½¿ç”¨ã€‚
- **TTTLayer**: Test-Time Trainingå±¤ã€‚`forward_update` (é€æ¬¡) ã¨ `forward_chunkwise` (ä¸¦åˆ—) ã®2ã¤ã®å®Ÿè¡Œãƒ‘ã‚¹ã€‚
- **BitLlamaBlock**: Attention + MLP + Residual ã‚’æŸã­ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã€‚
- **Llama**: è¤‡æ•°ã®Blockã‚’ç©ã¿é‡ã­ãŸå®Œå…¨ãªãƒ¢ãƒ‡ãƒ«ã€‚

### `train.rs` ã®è¨­è¨ˆ

- **`run()` é–¢æ•°**: å˜ä¸€ã®å·¨å¤§é–¢æ•°ã§å­¦ç¿’å…¨ä½“ã‚’åˆ¶å¾¡ã€‚
  - L101-150: åˆæœŸåŒ– (Device, Tokenizer, DataLoader)
  - L150-300: ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰
  - L300-500: å­¦ç¿’ãƒ«ãƒ¼ãƒ—
  - L500-564: ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¿å­˜

---

## 4. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚¹ã‚³ãƒ¼ãƒ—ææ¡ˆ

### Phase 1 (Core): `core_engine.rs` ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²

```
rust_engine/src/
â”œâ”€â”€ layers/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ rms_norm.rs      (RMSNorm)
â”‚   â”œâ”€â”€ bit_linear.rs    (BitLinear)
â”‚   â”œâ”€â”€ swiglu.rs        (SwiGLU)
â”‚   â””â”€â”€ ttt.rs           (TTTLayer)
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ block.rs         (BitLlamaBlock)
â”‚   â””â”€â”€ llama.rs         (Llama)
â”œâ”€â”€ python.rs            (PyO3 ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°)
â”œâ”€â”€ config.rs            (BitLlamaConfig)
â””â”€â”€ lib.rs               (å…¬é–‹API)
```

### Phase 2 (Enhancement): `train.rs` ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

```
bit_llama/src/train/
â”œâ”€â”€ mod.rs
â”œâ”€â”€ args.rs              (TrainArgs)
â”œâ”€â”€ loop.rs              (TrainingLoop trait/impl)
â”œâ”€â”€ checkpoint.rs        (CheckpointManager)
â””â”€â”€ metrics.rs           (MetricsLogger)
```

---

## 5. ãƒªã‚¹ã‚¯è©•ä¾¡

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | ç·©å’Œç­– |
|--------|--------|--------|
| PyO3 ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ç ´æ | é«˜ | `#[cfg(feature = "python")]` ã‚’ç¶­æŒã—ã¤ã¤æ…é‡ã«ç§»å‹• |
| å­¦ç¿’ãƒ«ãƒ¼ãƒ—ã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ | é«˜ | æ—¢å­˜ãƒ†ã‚¹ãƒˆ (`pre_demon.py`) ã®æ´»ç”¨ |
| APIäº’æ›æ€§ã®ç ´å£Š | ä¸­ | `pub use` ã«ã‚ˆã‚‹å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§äº’æ›æ€§ç¶­æŒ |

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Step 2 (Dependency Mapping) ã§ä¾å­˜é–¢ä¿‚å›³ã‚’ä½œæˆ
